name: Semáforo Legislativo - Pipeline Automático

# Se ejecuta cada 6 horas Y cuando haces push
on:
  schedule:
    - cron: '0 */6 * * *'  # Cada 6 horas: 00:00, 06:00, 12:00, 18:00 UTC
  workflow_dispatch:  # Permite ejecutarlo manualmente desde GitHub

permissions:
  contents: write  # Necesario para hacer push de data.json

jobs:
  pipeline:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      # 1. Descargar el código
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2. Instalar Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. Instalar dependencias
      - name: Instalar dependencias
        run: pip install -r requirements.txt

      # 4. Ejecutar el pipeline (sin Google Trends para evitar rate limits en CI)
      - name: Ejecutar pipeline
        run: python main.py --skip-trends

      # 5. Guardar la base de datos actualizada y publicar
      - name: Commit datos actualizados
        run: |
          git config user.name "FIAT Bot"
          git config user.email "fiat-bot@users.noreply.github.com"
          git add dashboard/data.json semaforo.db
          git diff --staged --quiet || git commit -m "Actualización automática $(date -u '+%Y-%m-%d %H:%M UTC')"
          git push
